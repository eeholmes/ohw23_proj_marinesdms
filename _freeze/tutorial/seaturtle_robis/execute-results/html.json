{
  "hash": "8425f933e9edadec5229e8f93c9bfd8f",
  "result": {
    "markdown": "---\ntitle: \"get turtle data\"\noutput: html_document\ndate: \"2023-08-08\"\n---\n\n\nHere we download from OBIS using the robis package.\n\n## Step 1 define the region of interest\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# lon, lon, lat, lat\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.11.1, GDAL 3.6.2, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlats <- c(-0.125, 32.125)\nlons <- c(41.875, 65.125)\n# raster extent is defined by west lon, east lon, south lat, north lat\next <- raster::extent(lons[1], lons[2], lats[1], lats[2])\nextent_polygon <- as(ext, \"SpatialPolygons\") %>% st_as_sf()\n# we need to assign a coordinate system; 4326 is the default for maps in sf\nsf::st_crs(extent_polygon)<-4326\n# convert to a WKT format\nwkt_geometry <- extent_polygon$geometry %>% st_as_text()\nwkt_geometry\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"POLYGON ((41.875 -0.125, 41.875 32.125, 65.125 32.125, 65.125 -0.125, 41.875 -0.125))\"\n```\n:::\n:::\n\n\nMake a map of our region so we know we have the right area.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(sf)\nlibrary(\"rnaturalearth\")\nlibrary(\"rnaturalearthdata\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rnaturalearthdata'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:rnaturalearth':\n\n    countries110\n```\n:::\n\n```{.r .cell-code}\nworld <- ne_countries(scale = \"medium\", returnclass = \"sf\")\nggplot(data = world) + geom_sf() +\n  geom_sf(data = extent_polygon, color = \"red\", fill=NA)\n```\n\n::: {.cell-output-display}\n![](seaturtle_robis_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Get occurrence data from robis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(robis)\nspp <- \"Caretta caretta\" # loggerhead\ndf <- occurrence(spp, startdate = as.Date(\"2000-01-01\"), geometry = wkt_geometry)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nRetrieved 5000 records of approximately 5269 (94%)\nRetrieved 5269 records of\napproximately 5269 (100%)\n```\n:::\n:::\n\n\nSubset columns and save.\n\n::: {.cell}\n\n```{.r .cell-code}\ncols.to.use <- c(\"occurrenceID\", \"scientificName\", \"dateIdentified\", \"eventDate\", \"decimalLatitude\", \"decimalLongitude\", \"coordinateUncertaintyInMeters\",\n                 \"individualCount\",\"lifeStage\", \"sex\",\n                 \"bathymetry\",  \"shoredistance\", \"sst\", \"sss\")\ndf <- df[,cols.to.use]\n```\n:::\n\n\nSave the data to a file for later use.\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(df, file=\"/home/jovyan/R/ohw23_proj_marinesdms/data/raw-bio/loggerhead-robis.csv\", quote=FALSE)\n```\n:::\n\n\n\n## Download data \n\nWe will download data for four sea turtles found in the Arabian sea and save to one file.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspp <- c(\"Chelonia mydas\", \"Caretta caretta\", \"Eretmochelys imbricata\", \"Lepidochelys olivacea\", \"Natator depressus\", \"Dermochelys coriacea\")\ndf <- occurrence(spp, startdate = as.Date(\"2000-01-01\"), geometry = wkt_geometry)\ncols.to.use <- c(\"occurrenceID\", \"scientificName\", \"dateIdentified\", \"eventDate\", \"decimalLatitude\", \"decimalLongitude\", \"coordinateUncertaintyInMeters\",\n                 \"individualCount\",\"lifeStage\", \"sex\",\n                 \"bathymetry\",  \"shoredistance\", \"sst\", \"sss\")\nif(!(all(cols.to.use %in% colnames(df)))) next\ndf <- df[,cols.to.use]\nfil=file.path(\n    \"/home\", \"jovyan\", \"R\", \"ohw23_proj_marinesdms\", \"data\", \"raw-bio\", \"io-sea-turtles.csv\")\nwrite.csv(df, file=fil, quote=FALSE, row.names = FALSE)\n```\n:::\n",
    "supporting": [
      "seaturtle_robis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}